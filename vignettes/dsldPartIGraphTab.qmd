## Deciding on a Set of Confounders

By now we know how to adjust for a confounder in our data. But how 
would we go about determining what can be a confounder in the first 
place?

Confounders, by their very nature, are a relationship between variables. 
It just so happens that those relationships affect the relationships we 
want to see.

The easiest way to notice those relationships is to graph them. If a 
confounder C is affecting the relationship between response variable Y and 
sensitive variable S, there should be a graphical trend between S and C. 
Luckily, **dsld** provides a host of functions that let you visually explore 
these trends.

### Confounders in Law School Admissions

Suppose we are investigating the relationship between LSAT exams scores and race 
(refer to @law-school above). We want to graphically explore the effects of the 
C, family income, on the relationship between Y, lsat score, and S, race.

We have to look at both the relationship between race and LSAT scores and the 
relationship between race and family income. We may also want to look at the
effects of GPA as well. A quick way to view multiple variables (and their
relation to the sensitive variable) at once is to plot them in a 3D scatter plot:

```{r, eval=FALSE}
data(law.school.admissions)
dsldScatterPlot3D(law.school.admissions, c('lsat','fam_inc','ugpa'), 'race1',
                  pointSize = 4)
```

![](graphTab/lawscatterplot3d2.png){width="90%"}

There are a couple things you can gather from a graph like this. Looking at the
fam_inc axis, the lowest quintile of family income is mostly populated with Black 
and Hispanic students, while the upper two levels are almost entirely made up of
white students. Interestingly on the lsat axis, most of those with a lower score 
happen to be non-white, across all income levels. On the other hand, the ugpa
axis has a similar trend to that of the lsat axis, albeit to a much weaker extent.

It is important to note that we cannot draw any concrete conclusions from this
graph alone. For one thing, having such a large majority of students being white
can make it hard to notice any hidden trends. We are only using this graph to 
look for anything that may affect our analysis of the relationship between race 
and LSAT scores. That being said, we can also say that it's possible that family 
income may confouding said relationship, only because the different levels look 
fairly different in terms of the races of the students that populate it--more on 
this later.

To further support our claim that race may be affecting LSAT results, we can 
look at the density plot of LSAT scores against different races.

```{r, eval=FALSE}
data(law.school.admissions)
dsldDensityByS(law.school.admissions, cName = "lsat", sName = "race1")
```

![](graphTab/lawdensitylsat.png){width="80%"}

Each curve represents the distribution of LSAT scores for each race, with the
peak of each curve representing the most common scores. From this, its easy
to see the possibility of racial bias in the LSAT. But again, this bias may be
confounded.

Recall that the scatter plot also indicated a potential trend between family 
income and race. We can zoom in on this relationship by generating another 
density plot:

```{r, eval=FALSE}
data(law.school.admissions)
dsldDensityByS(law.school.admissions, cName = "fam_inc", sName = "race1")
```

![](graphTab/lawdensityfam.png){width="80%"}

White students have larger peaks at income levels 3, 4, and 5, indicating that
a larger proportion of white students are in the higher income brackets than 
non-white students. Conversely, a larger proportion of black and Hispanic
students occupy the lower income bracket levels.

[If we wanted to investigate other potential confounders, we can call 
**dsldConfounders()** with 'race1' as our sensitive variable.]{.column-margin}

This suggests that family income could be confounding the potential causal 
relationship between race and LSAT scores, meaning it may be necessary to 
account for family income in our models.

::: {.callout-note}
#### Including vs Omitting a Confounder C
Other than possible overfitting, there is no harm in including a C when in fact 
it has little or no confounding effect, whereas omitting a C that IS a 
confounder is a major error.
:::

### Confounders in Engineering Wages

Sometimes our intuition may tell us that some feature may be a confounder 
when that may not be the case. For example, suppose we suspect that an 
employee's
[From the **svcensus** data]{.column-margin} 
education level influences the causal effect that gender may have on wage.

One way to further affirm/deny this claim is by using the function 
**dsldFrequencyByS()**, 
[You can also run **dsldConfounders()** and find this same result.]{.column-margin}
which aims to analyze categorical (not numeric) 
columns by printing out a list of frequencies. Since education level is 
categorical, we can call the function as follows:

```{r}
library(dsld)
data(svcensus)
dsldFrequencyByS(svcensus, "educ", "gender")
```

The similar frequency values between men and women suggest that we *cannot* 
confidently claim education to be a possible confounder.

On the other hand, we *do* see more interesting results if we look at 
*occupation* instead of *education*:

```{r}
library(dsld)
data(svcensus)
dsldFrequencyByS(svcensus, "occ", "gender")
```

Notice the difference between the proportion of males in occupation 106 vs 
females in that same occupation--a difference of approximately 11%. The 
difference in frequencies here are much greater than with the 'educ' example, 
which suggests that there is a difference in the occupations that men and 
women tend to be in; since different occupations correlate with different wages, 
it is possible that this difference in occupations that men have compared with 
what women have could be affecting the relationship between gender and wage. 

Since occupation may have a substantial impact on the relationship between gender 
and wage, it may be detrimental to omit occupation from any models that we generate 
for this relationship.

As always, further investigation is necessary to determine the extent of the impact 
that employee occupations have on the relationship we are analyzing.

